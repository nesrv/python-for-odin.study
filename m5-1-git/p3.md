# Продолжение урока по Git для Python-разработчиков: продвинутые техники

## 1. Отмена изменений в Git

### Отмена незакоммиченных изменений
```bash
# Отменить изменения в конкретном файле
git checkout -- file.py

# Отменить все незакоммиченные изменения
git reset --hard
```

### Изменение последнего коммита
```bash
# Добавить новые изменения в последний коммит
git add .
git commit --amend -m "Новое сообщение коммита"

# Изменить сообщение последнего коммита без изменения кода
git commit --amend -m "Новое сообщение" --no-edit
```

### Отмена коммитов
```bash
# Отменить последний коммит, сохраняя изменения в рабочей директории
git reset HEAD~1

# Полностью удалить последний коммит
git reset --hard HEAD~1

# Создать новый коммит, отменяющий изменения предыдущего
git revert HEAD
```

## 2. Работа с тегами (версиями)

```bash
# Создать легковесный тег
git tag v1.0.0

# Создать аннотированный тег
git tag -a v1.0.0 -m "Версия 1.0.0"

# Показать все теги
git tag

# Отправить теги на удалённый сервер
git push origin --tags

# Удалить тег локально и удалённо
git tag -d v1.0.0
git push origin :refs/tags/v1.0.0
```

## 3. Интерактивное добавление в индекс (staging area)

```bash
git add -i
```
Это откроет интерактивное меню где вы можете:
- Выбирать какие изменения добавить в коммит
- Просматривать изменения
- Отменять добавление файлов

## 4. Интерактивное перебазирование (rebase)

```bash
git rebase -i HEAD~3
```
Позволяет:
- Переупорядочить коммиты
- Объединить несколько коммитов в один (squash)
- Изменить сообщения коммитов
- Разделить коммиты

## 5. Поиск в истории

```bash
# Поиск по сообщению коммита
git log --grep="исправление"

# Поиск по изменениям в коде
git log -S"def calculate"

# Поиск по автору
git log --author="Имя"

# Графический просмотр истории
git log --graph --oneline --all
```

## 6. Хорошие практики для Python-проектов

### Структура коммитов
```
feat: добавить новый алгоритм сортировки

Добавлена реализация быстрой сортировки с оптимизацией
для маленьких массивов. Включает:
- Основную функцию quick_sort
- Вспомогательную функцию partition
- Тесты для различных случаев

Closes #123
```

### Conventional Commits
Используйте стандартные префиксы:
- `feat:` - новая функциональность
- `fix:` - исправление ошибки
- `docs:` - изменения документации
- `style:` - форматирование, отсутствие изменений в коде
- `refactor:` - изменения кода без исправления ошибки
- `test:` - добавление или исправление тестов
- `chore:` - обновление сборки, вспомогательные изменения

## 7. Git Hooks для Python-проектов

Пример pre-commit хука для проверки кода:

```bash
#!/bin/sh

# Проверка стиля кода с flake8
flake8 .
if [ $? -ne 0 ]; then
    echo "Flake8 проверка не пройдена"
    exit 1
fi

# Запуск тестов
python -m pytest tests/
if [ $? -ne 0 ]; then
    echo "Тесты не пройдены"
    exit 1
fi
```

Разместите в `.git/hooks/pre-commit` и сделайте исполняемым (`chmod +x`)

## 8. Работа с несколькими удалёнными репозиториями

```bash
# Добавить второй удалённый репозиторий
git remote add upstream https://github.com/original/repo.git

# Получить изменения из upstream
git fetch upstream

# Слить изменения из upstream в свою ветку
git merge upstream/main

# Отправить изменения в свой origin
git push origin main
```

## 9. Продвинутое разрешение конфликтов

При конфликте слияния:
1. Откройте файлы с конфликтами
2. Найдите маркеры конфликтов (`<<<<<<<`, `=======`, `>>>>>>>`)
3. Вручную объедините изменения
4. Добавьте исправленные файлы: `git add file.py`
5. Завершите слияние: `git commit`

Или используйте инструменты:
```bash
git mergetool  # запустит настроенный инструмент слияния
```

## 10. Git для командной работы (Git Flow)

1. `main`/`master` - стабильная версия
2. `develop` - текущая разработка
3. `feature/*` - ветки для новой функциональности
4. `release/*` - подготовка к выпуску
5. `hotfix/*` - срочные исправления

Пример рабочего процесса:
```bash
# Начать новую фичу
git checkout -b feature/new-auth develop

# Закончить фичу
git checkout develop
git merge --no-ff feature/new-auth
git branch -d feature/new-auth
git push origin develop
```

## Практическое задание (продвинутое)

1. Создайте несколько коммитов в своём Python-проекте, затем объедините их с помощью `rebase -i`
2. Создайте тег для версии вашего проекта
3. Настройте pre-commit хук для проверки PEP8
4. Сымитируйте конфликт слияния:
   - Создайте две ветки с изменениями одного файла
   - Попробуйте слить их
   - Разрешите конфликт
5. Создайте pull request на GitHub (если работаете с удалённым репозиторием)

## Полезные инструменты

1. **GitLens** - расширение для VS Code
2. **Tig** - консольный клиент для Git
3. **Lazygit** - TUI для Git
4. **GitPython** - библиотека для работы с Git из Python-кода
5. **Pre-commit** - фреймворк для управления хуками

```python
# Пример использования GitPython
import git

repo = git.Repo('.')
print(repo.git.status())
repo.git.add('file.py')
repo.git.commit(m='Добавлен новый файл')
```