# Урок по работе с модулем `shutil` в Python

Модуль `shutil` (сокращение от "shell utilities") предоставляет высокоуровневые операции для работы с файлами и директориями, дополняя функциональность модуля `os`.

## Основные возможности модуля shutil

### 1. Копирование файлов и директорий

#### `shutil.copy(src, dst)` - копирование файла
```python
import shutil

# Копирование файла
shutil.copy('source.txt', 'destination.txt')
print("Файл скопирован")
```

#### `shutil.copy2(src, dst)` - копирование с сохранением метаданных
```python
# Копирование с сохранением метаданных (время создания и т.д.)
shutil.copy2('source.txt', 'destination_meta.txt')
print("Файл скопирован с метаданными")
```

#### `shutil.copytree(src, dst)` - рекурсивное копирование директории
```python
# Копирование всей директории
shutil.copytree('source_dir', 'backup_dir')
print("Директория скопирована рекурсивно")
```

### 2. Перемещение файлов и директорий

#### `shutil.move(src, dst)` - перемещение/переименование
```python
# Перемещение файла
shutil.move('old_location.txt', 'new_location.txt')
print("Файл перемещен")

# Переименование файла
shutil.move('old_name.txt', 'new_name.txt')
print("Файл переименован")
```

### 3. Удаление директорий

#### `shutil.rmtree(path)` - рекурсивное удаление
```python
# Удаление директории со всем содержимым
shutil.rmtree('directory_to_delete')
print("Директория удалена со всем содержимым")
```

### 4. Работа с архивами

#### Создание архивов
```python
# Создание ZIP-архива
shutil.make_archive('backup', 'zip', 'folder_to_archive')
print("ZIP-архив создан")

# Создание tar.gz архива
shutil.make_archive('backup', 'gztar', 'folder_to_archive')
print("tar.gz архив создан")
```

#### Распаковка архивов
```python
import zipfile
import tarfile

# Распаковка ZIP
with zipfile.ZipFile('archive.zip', 'r') as zip_ref:
    zip_ref.extractall('extracted_zip')
print("ZIP-архив распакован")

# Распаковка tar.gz
with tarfile.open('archive.tar.gz', 'r:gz') as tar_ref:
    tar_ref.extractall('extracted_tar')
print("tar.gz архив распакован")
```

### 5. Дополнительные полезные функции

#### `shutil.disk_usage(path)` - информация о дисковом пространстве
```python
# Получение информации о свободном месте
usage = shutil.disk_usage('/')
print(f"Всего: {usage.total / (1024**3):.2f} GB")
print(f"Использовано: {usage.used / (1024**3):.2f} GB")
print(f"Свободно: {usage.free / (1024**3):.2f} GB")
```

#### `shutil.which(cmd)` - поиск исполняемого файла
```python
# Поиск расположения программы
python_path = shutil.which('python')
print(f"Python расположен в: {python_path}")
```

## Практические примеры

### Пример 1: Резервное копирование директории
```python
import shutil
import datetime

def create_backup(source_dir):
    # Создаем имя для бэкапа с датой
    today = datetime.datetime.now().strftime("%Y-%m-%d")
    backup_name = f"backup_{today}"
    
    # Создаем ZIP-архив
    shutil.make_archive(backup_name, 'zip', source_dir)
    print(f"Создан бэкап: {backup_name}.zip")

create_backup('important_data')
```

### Пример 2: Очистка временных файлов
```python
import shutil
import os

def clean_temp_files(temp_dir):
    # Проверяем существование директории
    if os.path.exists(temp_dir):
        # Удаляем со всем содержимым
        shutil.rmtree(temp_dir)
        # Создаем заново
        os.makedirs(temp_dir)
        print("Временные файлы очищены")
    else:
        print("Директория не существует")

clean_temp_files('temp')
```

### Пример 3: Синхронизация двух директорий
```python
import shutil
import os

def sync_dirs(source, destination):
    # Удаляем целевую директорию, если существует
    if os.path.exists(destination):
        shutil.rmtree(destination)
    
    # Копируем всю директорию
    shutil.copytree(source, destination)
    print(f"Директория {source} синхронизирована с {destination}")

sync_dirs('source_data', 'backup_data')
```

## Особенности и лучшие практики

1. **Обработка ошибок**: Всегда обрабатывайте возможные ошибки при работе с файлами
   ```python
   try:
       shutil.copy('important.txt', 'backup.txt')
   except FileNotFoundError:
       print("Исходный файл не найден")
   except PermissionError:
       print("Нет прав доступа")
   ```

2. **Кроссплатформенность**: `shutil` работает на всех платформах, но пути следует оформлять правильно
   ```python
   import os.path
   path = os.path.join('folder', 'subfolder', 'file.txt')
   ```

3. **Производительность**: Для больших файлов используйте `shutil.copyfileobj()`
   ```python
   with open('source.big', 'rb') as src, open('dest.big', 'wb') as dst:
       shutil.copyfileobj(src, dst, length=16*1024*1024)  # Буфер 16MB
   ```

## Заключение

Модуль `shutil` предоставляет удобные высокоуровневые операции для:
- Копирования и перемещения файлов/директорий
- Работы с архивами
- Управления дисковым пространством
- Создания резервных копий
- Очистки файловых структур

Он отлично дополняет модуль `os` для комплексной работы с файловой системой в Python.